[pytest]
# إعدادات pytest العامة
minversion = 7.0
addopts = 
    -ra
    --strict-markers
    --strict-config
    --verbose
    --tb=short
    --durations=10
    --cov=app
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-report=xml:coverage.xml
    --cov-fail-under=80
    --cov-branch
    --cov-append

# مجلدات الاختبارات
testpaths = 
    backend/tests
    tests

# نمط ملفات الاختبار
python_files = 
    test_*.py
    *_test.py
    tests.py

# نمط دوال الاختبار
python_functions = 
    test_*
    *_test

# نمط فئات الاختبار
python_classes = 
    Test*
    *Tests

# العلامات (Markers)
markers =
    # اختبارات أساسية
    unit: اختبارات الوحدة
    integration: اختبارات التكامل
    end_to_end: اختبارات من البداية للنهاية
    
    # اختبارات المتصفحات
    browser: اختبارات المتصفح
    selenium: اختبارات Selenium
    playwright: اختبارات Playwright
    
    # اختبارات الأداء
    performance: اختبارات الأداء
    load_test: اختبارات الحمولة
    stress_test: اختبارات الإجهاد
    memory_test: اختبارات الذاكرة
    
    # اختبارات الأمان
    security: اختبارات الأمان
    auth_test: اختبارات المصادقة
    penetration: اختبارات الاختراق
    
    # اختبارات قاعدة البيانات
    database: اختبارات قاعدة البيانات
    db_test: اختبارات قاعدة البيانات
    sql_test: اختبارات SQL
    
    # اختبارات API
    api: اختبارات API
    api_test: اختبارات API
    rest_api: اختبارات REST API
    
    # اختبارات التكاملات
    integration_test: اختبارات التكامل
    webhook: اختبارات Webhooks
    oauth: اختبارات OAuth
    
    # اختبارات الرسائل
    messaging: اختبارات الرسائل
    email_test: اختبارات البريد الإلكتروني
    sms_test: اختبارات الرسائل النصية
    whatsapp_test: اختبارات WhatsApp
    
    # اختبارات التكاملات الخارجية
    shopify_test: اختبارات Shopify
    meta_ads_test: اختبارات Meta Ads
    google_ads_test: اختبارات Google Ads
    
    # اختبارات إبطاء الاختبارات
    slow: اختبارات بطيئة
    timeout: اختبارات محددة زمنياً
    
    # اختبارات تخطي
    skip: تخطي الاختبار
    skip_if_no_db: تخطي إذا لم تكن قاعدة البيانات متوفرة
    skip_if_no_external: تخطي إذا لم تكن الخدمات الخارجية متوفرة
    
    # اختبارات متطلبات مميزة
    requires_network: يتطلب شبكة
    requires_api_key: يتطلب مفتاح API
    requires_db: يتطلب قاعدة بيانات
    requires_external: يتطلب خدمات خارجية
    
    # اختبارات التطوير
    development: اختبارات التطوير
    debug: اختبارات التصحيح
    
    # اختبارات المنتج
    production: اختبارات المنتج
    smoke: اختبارات الدخان
    
    # علامات أخرى
    custom: مخصص
    wip: قيد العمل
    draft: مسودة

# إعدادات التغطية
[tool:pytest]
# تعطيل تغطية للملفات التالية
norecursedirs = 
    .git
    .tox
    .pytest_cache
    __pycache__
    *.egg
    *.egg-info
    build
    dist
    .venv
    venv
    env
    node_modules
    .next
    .coverage
    htmlcov
    *.html
    *.xml

# المتغيرات البيئية للاختبارات
env = 
    ENVIRONMENT=test
    DATABASE_URL=postgresql://test:test@localhost:5432/saler_test
    REDIS_URL=redis://localhost:6379/1
    SECRET_KEY=test_secret_key_for_testing
    JWT_SECRET=test_jwt_secret_key
    JWT_ALGORITHM=HS256
    JWT_EXPIRATION=3600
    
    # مفاتيح API للاختبارات
    SHOPIFY_API_KEY=test_shopify_api_key
    SHOPIFY_API_SECRET=test_shopify_api_secret
    META_APP_ID=test_meta_app_id
    META_APP_SECRET=test_meta_app_secret
    WHATSAPP_TOKEN=test_whatsapp_token
    WHATSAPP_VERIFY_TOKEN=test_whatsapp_verify_token
    
    # إعدادات الخدمات الخارجية
    GOOGLE_ANALYTICS_ID=test_ga_id
    SENTRY_DSN=test_sentry_dsn
    EMAIL_SERVICE_URL=http://localhost:8025
    SMS_SERVICE_URL=http://localhost:8080
    
    # إعدادات الأمان للاختبارات
    BCRYPT_ROUNDS=4
    CORS_ORIGINS=["http://localhost:3000", "http://localhost:3001"]
    RATE_LIMIT_PER_MINUTE=1000
    
    # إعدادات قاعدة البيانات
    DB_POOL_SIZE=5
    DB_MAX_OVERFLOW=10
    DB_TIMEOUT=30
    DB_POOL_RECYCLE=3600
    
    # إعدادات التخزين
    STORAGE_BUCKET=test-bucket
    STORAGE_REGION=us-east-1
    
    # إعدادات الذاكرة المؤقتة
    CACHE_TTL=300
    CACHE_MAX_SIZE=1000
    
    # إعدادات التسجيل
    LOG_LEVEL=DEBUG
    LOG_FORMAT=json

# إعدادات إضافية
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning
    
    # تجاهل تحذيرات محددة للاختبارات
    ignore:.*You are using.*:UserWarning:pytest_cov.*
    ignore:.*assigning the function.*:DeprecationWarning:*
    ignore:.*Invalid HTTP request line.*:pytest_httpx.*

# إعدادات التسجيل
log_cli = true
log_cli_level = DEBUG
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = tests.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(filename)s:%(lineno)d %(funcName)s(): %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# إعدادات الذاكرة المؤقتة
cache_dir = .pytest_cache

# إعدادات التحكم في الإخراج
console_output_style = progress

# إعدادات التوقيت
timeout = 300  # 5 دقائق للاختبار الواحد
timeout_method = thread

# إعدادات التهيئة
addini_header_lines = true

# إعدادات المتغيرات
env_add_section = true