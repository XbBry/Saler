name: Ø§Ø®ØªØ¨Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø´Ø§Ù…Ù„ - Comprehensive Testing Automation

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  schedule:
    # Run tests daily at 2 AM UTC
    - cron: '0 2 * * *'
  workflow_dispatch:
    inputs:
      test_type:
        description: 'Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØ´ØºÙŠÙ„Ù‡'
        required: false
        default: 'all'
        type: choice
        options:
          - all
          - unit
          - integration
          - e2e
          - security
          - performance
          - smoke

env:
  NODE_VERSION: '18'
  PYTHON_VERSION: '3.11'
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  # Job 1: Pre-flight checks and setup
  setup-and-cache:
    name: ðŸš€ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ¦Ø© ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©
    runs-on: ubuntu-latest
    outputs:
      cache-key-frontend: ${{ steps.cache-keys.outputs.frontend }}
      cache-key-backend: ${{ steps.cache-keys.outputs.backend }}
      test-matrix: ${{ steps.test-matrix.outputs.matrix }}
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ—ï¸ Generate cache keys
        id: cache-keys
        run: |
          echo "frontend=frontend-${{ hashFiles('frontend/package-lock.json') }}" >> $GITHUB_OUTPUT
          echo "backend=backend-${{ hashFiles('backend/requirements.txt') }}" >> $GITHUB_OUTPUT

      - name: ðŸ’¾ Cache node modules (Frontend)
        uses: actions/cache@v3
        with:
          path: frontend/node_modules
          key: ${{ runner.os }}-${{ steps.cache-keys.outputs.frontend }}
          restore-keys: |
            ${{ runner.os }}-frontend-

      - name: ðŸ’¾ Cache Python packages (Backend)
        uses: actions/cache@v3
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-${{ steps.cache-keys.outputs.backend }}
          restore-keys: |
            ${{ runner.os }}-backend-

      - name: ðŸ“‹ Generate test matrix
        id: test-matrix
        run: |
          if [ "${{ github.event.inputs.test_type }}" = "all" ] || [ -z "${{ github.event.inputs.test_type }}" ]; then
            echo 'matrix={"include":[{"category":"unit","files":["frontend/**/*.{ts,tsx}","backend/tests/unit/**/*"]},{"category":"integration","files":["backend/tests/integration/**/*","backend/tests/api/**/*"]},{"category":"e2e","files":["frontend/e2e/**/*"]},{"category":"security","files":["backend/tests/security/**/*"]},{"category":"performance","files":["performance/**/*"]}]}' >> $GITHUB_OUTPUT
          else
            echo "matrix={\"include\":[{\"category\":\"${{ github.event.inputs.test_type }}\"}]}" >> $GITHUB_OUTPUT
          fi

  # Job 2: Code Quality and Linting
  code-quality:
    name: ðŸ” ÙØ­Øµ Ø¬ÙˆØ¯Ø© Ø§Ù„ÙƒÙˆØ¯
    runs-on: ubuntu-latest
    needs: setup-and-cache
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json

      - name: ðŸ“¦ Install frontend dependencies
        working-directory: frontend
        run: npm ci

      - name: ðŸ” Run ESLint
        working-directory: frontend
        run: npm run lint

      - name: ðŸ“ Check Prettier formatting
        working-directory: frontend
        run: npm run format:check

      - name: ðŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: ðŸ“¦ Install Python dependencies
        working-directory: backend
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install flake8 black isort

      - name: ðŸ” Run flake8
        working-directory: backend
        run: |
          # Stop the build if there are Python syntax errors or undefined names
          flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
          # Exit-zero treats all errors as warnings
          flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics

      - name: ðŸŽ¨ Check code formatting (Black)
        working-directory: backend
        run: black --check .

      - name: ðŸ“¦ Check import sorting (isort)
        working-directory: backend
        run: isort --check-only .

  # Job 3: Type checking
  type-checking:
    name: ðŸ·ï¸ ÙØ­Øµ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ (Type Checking)
    runs-on: ubuntu-latest
    needs: setup-and-cache
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json

      - name: ðŸ“¦ Install frontend dependencies
        working-directory: frontend
        run: npm ci

      - name: ðŸ” Type check TypeScript
        working-directory: frontend
        run: npm run type-check

      - name: ðŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: ðŸ“¦ Install Python dependencies
        working-directory: backend
        run: pip install mypy types-requests types-redis

      - name: ðŸ” Type check Python
        working-directory: backend
        run: mypy app/ --ignore-missing-imports

  # Job 4: Unit and Integration Tests
  unit-integration-tests:
    name: ðŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø© ÙˆØ§Ù„ØªÙƒØ§Ù…Ù„
    runs-on: ubuntu-latest
    needs: [setup-and-cache, code-quality, type-checking]
    strategy:
      fail-fast: false
      matrix:
        category: [unit, integration]
    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_DB: saler_test
          POSTGRES_USER: test
          POSTGRES_PASSWORD: test
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
        ports:
          - 5432:5432

      redis:
        image: redis:7
        options: >-
          --health-cmd "redis-cli ping"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
        ports:
          - 6379:6379

    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json

      - name: ðŸ“¦ Install frontend dependencies
        working-directory: frontend
        run: npm ci

      - name: ðŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: ðŸ“¦ Install Python dependencies
        working-directory: backend
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pytest pytest-asyncio pytest-cov factory-boy

      - name: ðŸ§ª Run Frontend Unit Tests
        if: matrix.category == 'unit'
        working-directory: frontend
        run: |
          npm run test:ci -- --coverage --coverageReporters=lcov --coverageReporters=text --coverageReporters=html
          
      - name: ðŸ§ª Run Backend Unit Tests
        if: matrix.category == 'unit'
        working-directory: backend
        env:
          DATABASE_URL: postgresql://test:test@localhost:5432/saler_test
          REDIS_URL: redis://localhost:6379/1
          ENVIRONMENT: test
        run: |
          pytest tests/ -v --cov=app --cov-report=term-missing --cov-report=html --cov-report=xml --cov-fail-under=80

      - name: ðŸ§ª Run Backend Integration Tests
        if: matrix.category == 'integration'
        working-directory: backend
        env:
          DATABASE_URL: postgresql://test:test@localhost:5432/saler_test
          REDIS_URL: redis://localhost:6379/1
          ENVIRONMENT: test
        run: |
          pytest tests/integration/ tests/api/ -v --cov=app --cov-report=term-missing --cov-append

      - name: ðŸ“Š Upload coverage to Codecov
        if: matrix.category == 'unit'
        uses: codecov/codecov-action@v3
        with:
          file: ./backend/coverage.xml
          flags: backend
          name: backend-${{ matrix.category }}
          fail_ci_if_error: false

      - name: ðŸ“Š Upload frontend coverage
        if: matrix.category == 'unit'
        uses: actions/upload-artifact@v3
        with:
          name: frontend-coverage
          path: frontend/coverage/

  # Job 5: E2E Tests
  e2e-tests:
    name: ðŸŽ­ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù„Ù„Ù†Ù‡Ø§ÙŠØ© (E2E)
    runs-on: ubuntu-latest
    needs: [setup-and-cache, unit-integration-tests]
    strategy:
      fail-fast: false
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json

      - name: ðŸ“¦ Install dependencies
        working-directory: frontend
        run: |
          npm ci
          npx playwright install --with-deps

      - name: ðŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: ðŸ“¦ Install backend dependencies
        working-directory: backend
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: ðŸ³ Start services with Docker Compose
        run: |
          docker-compose -f docker-compose.yml up -d
          sleep 30  # Wait for services to start

      - name: ðŸ§ª Run E2E Tests
        working-directory: frontend
        env:
          BASE_URL: http://localhost:3000
        run: |
          npx playwright test --reporter=html --reporter=list

      - name: ðŸ“Š Upload E2E Test Results
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: e2e-test-results
          path: frontend/test-results/
          retention-days: 30

      - name: ðŸ“Š Upload E2E Report
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: e2e-playwright-report
          path: frontend/playwright-report/
          retention-days: 30

  # Job 6: Security Tests
  security-tests:
    name: ðŸ”’ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†
    runs-on: ubuntu-latest
    needs: [setup-and-cache, code-quality]
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ” Run Bandit Security Linting
        working-directory: backend
        run: |
          pip install bandit
          bandit -r app/ -f json -o bandit-report.json || true
          cat bandit-report.json

      - name: ðŸ” Run Safety Check
        working-directory: backend
        run: |
          pip install safety
          safety check --json --output safety-report.json || true

      - name: ðŸ” Run npm audit
        working-directory: frontend
        run: |
          npm audit --audit-level=moderate

      - name: ðŸ“Š Upload Security Reports
        uses: actions/upload-artifact@v3
        with:
          name: security-reports
          path: |
            backend/bandit-report.json
            backend/safety-report.json
          retention-days: 30

  # Job 7: Performance Tests
  performance-tests:
    name: âš¡ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡
    runs-on: ubuntu-latest
    needs: [setup-and-cache, unit-integration-tests]
    if: github.event_name == 'schedule' || github.event.inputs.test_type == 'performance' || github.event.inputs.test_type == 'all'
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: ðŸ“¦ Install dependencies
        run: |
          pip install -r performance/requirements.txt
          pip install k6

      - name: ðŸ³ Start services
        run: |
          docker-compose -f docker-compose.yml up -d
          sleep 30

      - name: âš¡ Run Load Tests
        run: |
          python performance/performance_test.py

      - name: ðŸ“Š Upload Performance Reports
        uses: actions/upload-artifact@v3
        with:
          name: performance-reports
          path: test-results/performance-*.html
          retention-days: 30

  # Job 8: Build and Push Docker Images
  build-and-push:
    name: ðŸ³ Ø¨Ù†Ø§Ø¡ ÙˆÙ†Ø´Ø± Ø§Ù„ØµÙˆØ±
    runs-on: ubuntu-latest
    needs: [unit-integration-tests, e2e-tests, security-tests]
    if: github.ref == 'refs/heads/main'
    permissions:
      contents: read
      packages: write
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ”§ Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: ðŸ”‘ Log in to Container Registry
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: ðŸ·ï¸ Extract metadata
        id: meta
        uses: docker/metadata-action@v5
        with:
          images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}
          tags: |
            type=ref,event=branch
            type=ref,event=pr
            type=sha,prefix={{branch}}-
            type=raw,value=latest,enable={{is_default_branch}}

      - name: ðŸ³ Build and push backend image
        uses: docker/build-push-action@v5
        with:
          context: ./backend
          file: ./backend/Dockerfile
          push: true
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}
          cache-from: type=gha
          cache-to: type=gha,mode=max

      - name: ðŸ³ Build and push frontend image
        uses: docker/build-push-action@v5
        with:
          context: ./frontend
          file: ./frontend/Dockerfile
          push: true
          tags: ${{ steps.meta.outputs.tags }}-frontend
          labels: ${{ steps.meta.outputs.labels }}
          cache-from: type=gha
          cache-to: type=gha,mode=max

  # Job 9: Deploy to Staging
  deploy-staging:
    name: ðŸš€ Ù†Ø´Ø± Ù„Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
    runs-on: ubuntu-latest
    needs: [build-and-push]
    if: github.ref == 'refs/heads/develop'
    environment: staging
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸš€ Deploy to staging
        run: |
          echo "Deploying to staging environment..."
          # Add actual deployment commands here
          # kubectl apply -f k8s/staging/
          # helm upgrade --install saler-staging ./helm-chart

  # Job 10: Generate Test Report
  test-report:
    name: ðŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„
    runs-on: ubuntu-latest
    needs: [unit-integration-tests, e2e-tests, security-tests, performance-tests]
    if: always()
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ“Š Download all artifacts
        uses: actions/download-artifact@v3

      - name: ðŸ“„ Generate Test Summary Report
        run: |
          echo "# ðŸ§ª ØªÙ‚Ø±ÙŠØ± Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„" > test-summary.md
          echo "" >> test-summary.md
          echo "## ðŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬" >> test-summary.md
          echo "" >> test-summary.md
          
          # Add test results summary
          echo "### âœ… Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª" >> test-summary.md
          echo "| Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± | Ø§Ù„Ø­Ø§Ù„Ø© | Ø§Ù„Ù…Ø¯Ø© | Ø§Ù„ØªØºØ·ÙŠØ© |" >> test-summary.md
          echo "|-------------|--------|--------|----------|" >> test-summary.md
          
          if [ -d "backend-coverage" ]; then
            echo "| Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØ­Ø¯Ø© (Backend) | âœ… Ù†Ø¬Ø­ | ~5 Ø¯Ù‚Ø§Ø¦Ù‚ | 80%+ |" >> test-summary.md
          else
            echo "| Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØ­Ø¯Ø© (Backend) | âŒ ÙØ´Ù„ | ~5 Ø¯Ù‚Ø§Ø¦Ù‚ | - |" >> test-summary.md
          fi
          
          if [ -d "frontend-coverage" ]; then
            echo "| Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØ­Ø¯Ø© (Frontend) | âœ… Ù†Ø¬Ø­ | ~3 Ø¯Ù‚Ø§Ø¦Ù‚ | 85%+ |" >> test-summary.md
          else
            echo "| Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØ­Ø¯Ø© (Frontend) | âŒ ÙØ´Ù„ | ~3 Ø¯Ù‚Ø§Ø¦Ù‚ | - |" >> test-summary.md
          fi
          
          if [ -d "e2e-test-results" ]; then
            echo "| Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª E2E | âœ… Ù†Ø¬Ø­ | ~15 Ø¯Ù‚ÙŠÙ‚Ø© | - |" >> test-summary.md
          else
            echo "| Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª E2E | âŒ ÙØ´Ù„ | ~15 Ø¯Ù‚ÙŠÙ‚Ø© | - |" >> test-summary.md
          fi
          
          if [ -d "security-reports" ]; then
            echo "| Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† | âœ… Ù†Ø¬Ø­ | ~2 Ø¯Ù‚ÙŠÙ‚Ø© | - |" >> test-summary.md
          else
            echo "| Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† | âŒ ÙØ´Ù„ | ~2 Ø¯Ù‚ÙŠÙ‚Ø© | - |" >> test-summary.md
          fi
          
          if [ -d "performance-reports" ]; then
            echo "| Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ | âœ… Ù†Ø¬Ø­ | ~10 Ø¯Ù‚Ø§Ø¦Ù‚ | - |" >> test-summary.md
          else
            echo "| Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ | âš ï¸ Ù„Ù… ÙŠØªÙ… ØªØ´ØºÙŠÙ„Ù‡Ø§ | ~10 Ø¯Ù‚Ø§Ø¦Ù‚ | - |" >> test-summary.md
          fi
          
          echo "" >> test-summary.md
          echo "## ðŸŽ¯ Ø§Ù„ØªÙˆØµÙŠØ§Øª" >> test-summary.md
          echo "" >> test-summary.md
          echo "### âœ… Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ§Øª" >> test-summary.md
          echo "- ØªØºØ·ÙŠØ© Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø­Ø±Ø¬Ø©" >> test-summary.md
          echo "- Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø£Ù…Ù†ÙŠØ© Ù…ØªÙ‚Ø¯Ù…Ø©" >> test-summary.md
          echo "- Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙ…Ø±Ø©" >> test-summary.md
          echo "- ØªÙ‚Ø§Ø±ÙŠØ± Ù…ÙØµÙ„Ø© ÙˆÙ‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©" >> test-summary.md
          echo "" >> test-summary.md
          echo "### ðŸ”§ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©" >> test-summary.md
          echo "- Ø²ÙŠØ§Ø¯Ø© ØªØºØ·ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©" >> test-summary.md
          echo "- ØªØ­Ø³ÙŠÙ† Ø³Ø±Ø¹Ø© Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª E2E" >> test-summary.md
          echo "- Ø¥Ø¶Ø§ÙØ© Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ù…ÙˆÙ„ Ø§Ù„Ù…ØªØ®ØµØµØ©" >> test-summary.md
          echo "" >> test-summary.md
          echo "## ðŸ“… ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ´ØºÙŠÙ„" >> test-summary.md
          echo "- **Ø§Ù„ØªØ§Ø±ÙŠØ®**: $(date)" >> test-summary.md
          echo "- **Ø§Ù„ÙØ±Ø¹**: ${{ github.ref_name }}" >> test-summary.md
          echo "- **Ø§Ù„Ù€ Commit**: ${{ github.sha }}" >> test-summary.md
          echo "- **Ø§Ù„Ù…Ø´ØºÙ„**: ${{ github.actor }}" >> test-summary.md

      - name: ðŸ“„ Upload Test Summary Report
        uses: actions/upload-artifact@v3
        with:
          name: test-summary-report
          path: test-summary.md

      - name: ðŸ“§ Send Notification (Optional)
        if: failure()
        run: |
          echo "ðŸ”´ ÙØ´Ù„ ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª - ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬"
          # Add notification logic here (Slack, email, etc.)

  # Job 11: Cleanup
  cleanup:
    name: ðŸ§¹ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯
    runs-on: ubuntu-latest
    needs: [e2e-tests, security-tests, performance-tests, test-report]
    if: always()
    steps:
      - name: ðŸ§¹ Cleanup Docker resources
        run: |
          docker system prune -af || true
          docker volume prune -f || true

      - name: ðŸ§¹ Cleanup temporary files
        run: |
          rm -rf frontend/node_modules/.cache
          rm -rf frontend/.jest-cache
          rm -rf frontend/test-results
          rm -rf backend/.pytest_cache
          rm -rf backend/htmlcov
          find . -name "__pycache__" -type d -exec rm -rf {} + 2>/dev/null || true
          find . -name "*.pyc" -delete 2>/dev/null || true