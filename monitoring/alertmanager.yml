# Alertmanager Configuration
# Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª

global:
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_from: 'alerts@saler.com'
  smtp_auth_username: 'alerts@saler.com'
  smtp_auth_password: '${SMTP_PASSWORD}'
  resolve_timeout: 5m

route:
  group_by: ['alertname', 'instance']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'default-receiver'
  routes:
    # Critical alerts - ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø­Ø±Ø¬Ø©
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 5s
      repeat_interval: 5m

    # Warning alerts - ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ØªØ­Ø°ÙŠØ±ÙŠØ©
    - match:
        severity: warning
      receiver: 'warning-alerts'
      group_wait: 30s
      repeat_interval: 30m

    # Security alerts - ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†
    - match:
        alertname: security
      receiver: 'security-alerts'
      group_wait: 10s
      repeat_interval: 15m

    # Application errors - Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    - match:
        alertname: application_error
      receiver: 'app-errors'
      group_wait: 15s
      repeat_interval: 10m

    # Performance issues - Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡
    - match:
        alertname: performance
      receiver: 'performance-alerts'
      group_wait: 30s
      repeat_interval: 20m

# ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ØªÙ„Ù‚ÙŠÙŠÙ† - Receivers
receivers:
  - name: 'default-receiver'
    email_configs:
      - to: 'admin@saler.com'
        subject: '[Saler] ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ø§Ù… - {{ groupLabels.alertname }}'
        body: |
          Ù…Ø±Ø­Ø¨Ø§Ù‹,
          
          ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…:
          â€¢ Ù†ÙˆØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡: {{ groupLabels.alertname }}
          â€¢ Ø§Ù„Ø®Ø§Ø¯Ù…: {{ groupLabels.instance }}
          â€¢ Ø§Ù„ÙˆÙ‚Øª: {{ .CommonAnnotations.timestamp }}
          
          Ø§Ù„ØªÙØ§ØµÙŠÙ„:
          {{ range .Alerts }}
          â€¢ Ø§Ù„Ø­Ø§Ù„Ø©: {{ .Status }}
          â€¢ Ø§Ù„ÙˆØµÙ: {{ .Annotations.summary }}
          {{ end }}
          
          ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…: https://grafana.saler.com
          
          ØªØ­ÙŠØ§ØªÙ†Ø§,
          Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©

  - name: 'critical-alerts'
    email_configs:
      - to: 'admin@saler.com,oncall@saler.com'
        subject: '[ğŸš¨ Ø­Ø±Ø¬] {{ .GroupLabels.alertname }}'
        body: |
          ğŸš¨ ØªÙ†Ø¨ÙŠÙ‡ Ø­Ø±Ø¬ ğŸš¨
          
          {{ range .Alerts }}
          â€¢ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: {{ .Annotations.summary }}
          â€¢ Ø§Ù„ÙˆØµÙ: {{ .Annotations.description }}
          â€¢ Ø§Ù„Ø®Ø§Ø¯Ù…: {{ .Labels.instance }}
          â€¢ Ø§Ù„ÙˆÙ‚Øª: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}
          
          ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙÙˆØ±ÙŠØ©!
          
    slack_configs:
      - api_url: '${SLACK_WEBHOOK_URL}'
        channel: '#critical-alerts'
        title: 'ğŸš¨ ØªÙ†Ø¨ÙŠÙ‡ Ø­Ø±Ø¬'
        text: '{{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'
        send_resolved: true

  - name: 'warning-alerts'
    email_configs:
      - to: 'team@saler.com'
        subject: '[âš ï¸ ØªØ­Ø°ÙŠØ±] {{ .GroupLabels.alertname }}'
        body: |
          âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ ØªØ­Ø°ÙŠØ±ÙŠ âš ï¸
          
          {{ range .Alerts }}
          â€¢ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: {{ .Annotations.summary }}
          â€¢ Ø§Ù„Ø®Ø§Ø¯Ù…: {{ .Labels.instance }}
          {{ end }}

  - name: 'security-alerts'
    email_configs:
      - to: 'security@saler.com'
        subject: '[ğŸ”’ Ø£Ù…Ø§Ù†] {{ .GroupLabels.alertname }}'
        body: |
          ğŸ”’ ØªÙ†Ø¨ÙŠÙ‡ Ø£Ù…Ø§Ù† ğŸ”’
          
          {{ range .Alerts }}
          â€¢ Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯: {{ .Annotations.summary }}
          â€¢ Ø§Ù„ÙˆØµÙ: {{ .Annotations.description }}
          â€¢ Ø§Ù„Ù…ØµØ¯Ø±: {{ .Labels.source }}
          â€¢ Ø§Ù„ÙˆÙ‚Øª: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}
          
          ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ù…Ù†ÙŠØ© Ø§Ù„ÙÙˆØ±ÙŠØ©!

  - name: 'app-errors'
    email_configs:
      - to: 'developers@saler.com'
        subject: '[ğŸ› ØªØ·Ø¨ÙŠÙ‚] {{ .GroupLabels.alertname }}'
        body: |
          ğŸ› Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ğŸ›
          
          {{ range .Alerts }}
          â€¢ Ø§Ù„Ø®Ø·Ø£: {{ .Annotations.summary }}
          â€¢ Ø§Ù„Ø®Ø¯Ù…Ø©: {{ .Labels.service }}
          â€¢ Ø§Ù„Ù†Ø³Ø®Ø©: {{ .Labels.version }}
          {{ end }}

  - name: 'performance-alerts'
    email_configs:
      - to: 'devops@saler.com'
        subject: '[âš¡ Ø£Ø¯Ø§Ø¡] {{ .GroupLabels.alertname }}'
        body: |
          âš¡ Ù…Ø´ÙƒÙ„Ø© Ø£Ø¯Ø§Ø¡ âš¡
          
          {{ range .Alerts }}
          â€¢ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: {{ .Annotations.summary }}
          â€¢ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: {{ .Annotations.current_value }}
          â€¢ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©: {{ .Annotations.target_value }}
          {{ end }}

# Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªØµØ¹ÙŠØ¯ - Escalation Rules
inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance']

  - source_match:
      alertname: 'high_error_rate'
    target_match:
      alertname: 'service_down'
    equal: ['instance']